# HTTP/1.0 / HTTP/1.1

## HTTP/1.0 与 HTTP0.9 相比

1. 具有新的请求方式，如 POST、PUT、DELETE 等
2. 增添了请求头和响应头的概念，在通信中指定了 HTTP 协议版本号，以及其他的一些元信息
   - 缓存：Expire、Last-modified 等
   - HTTP 状态码：200、404 等
   - 内容编码：Content-type，客户端会根据这个内容去进行解析。（blog 里面的 svg 验证码就需要标注这是一个 svg 的 content）
3. 扩充了传输内容格式，图片、音视频资源、二进制等都可以进行传输

## HTTP/1.0 特性

- 无状态：服务器不跟踪不记录请求过的状态（如何理解？答：服务器不记得每个访问都是啥，不保留访问状态，每次访问都是船新的）
  - 服务器可以通过 cookies、session 来记录不同浏览器的状态、身份验证。
- 无连接：每个请求都需要重新进行 tcp 链接
  - 有性能问题。多个资源请求每次都要重新建立 tcp 链接，三握四挥，浪费资源。
  - 队头阻塞 (HOL, [更详细的见此](./hol.md))。HTTP 1.0 规定在前一个请求响应到达之后下一个请求才能发送，如果前一个阻塞，后面的请求也给阻塞的。

## HTTP/1.1 与 HTTP/1.0 相比

- 支持长连接：新增 Connection 字段，可以设置 keep-alive 值保持连接不断开（可以设置 keep-alive 时长防止过多占用， nginx 里面有这个配置选项）
- 管道化(pipeline)：基于上面长连接的基础，管道化可以不等第一个请求响应继续发送后面的请求，但响应的顺序还是按照请求的顺序返回。
  - HTTP/1.1 还是会有排队问题：假设 Apache 设置了最大并发数为 300，因为浏览器限制，浏览器发起的最大请求数为 6（safari/chrome），也就是服务器能承载的最高并发为 50，当第 51 个人访问时，就需要等待前面某个请求处理完成。
  - 非管道化：请求 1 > 响应 1 --> 请求 2 > 响应 2 --> 请求 3 > 响应 3
  - 管道化：请求 1 --> 请求 2 --> 请求 3 > 响应 1 --> 响应 2 --> 响应 3
  - 管道化可以一次发送多个请求，但是响应仍是顺序返回，仍然无法解决队头阻塞的问题。
- 缓存处理：新增字段 cache-control (可以选择不同的缓存策略，项目中用合适的缓存策略可以极大的减小服务器压力)
- 断点传输。(是什么？答：在上传/下载资源时，如果资源过大，将其分割为多个部分，分别上传/下载，如果遇到网络故障，可以从已经上传/下载好的地方继续请求，不用从头开始，提高效率)

## HTTP/2 特性

同 HTTP/1 的主要差异: 加入了 frames

### 二进制分帧（<HTTPs://halfrost.com/HTTP/2-HTTP-frames-definitions/）>

- HTTP 1.x 的解析是基于文本，HTTP 2 之后将所有传输的信息分割为更小的消息和帧(frame)，并对它们采用二进制格式的编码，提高传输效率。
- Connection 连接:1 个 TCP 连接，包含 1 个或者多个 stream。所有通信都在一个 TCP 连接上完成，此连接可以承载任意数量的双向数据流。
- Stream 数据流：一个双向通信的数据流，包含 1 条或者多条 Message。每个数据流都有一个唯一的标识符和可选的优先级信息，用于承载双向消息。
- Message 消息：对应 HTTP/1.1 中的请求 request 或者响应 response，包含 1 条或者多条 Frame。
- Frame 数据帧：最小通信单位，以二进制压缩格式存放内容。来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装。

### 多路复用(multi-plexing)： 在共享 TCP 链接的基础上同时发送请求和响应

在共享 TCP 链接的基础上同时发送请求和响应，基于二进制分帧，在同一域名下所有访问都是从同一个 tcp 连接中走，HTTP 消息被分解为独立的帧，乱序发送，服务端根据标识符和首部将消息重新组装起来。简要来说, 在同一个 TCP 连接，同一时刻可以传输处理多个 HTTP 请求。

- 理解：多路复用，就是在一个 TCP 连接中可以存在多条流。换句话说，也就是可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以避免 HTTP 1/1.1 中的队头阻塞问题，极大的提高传输性能。

### HTTP/2 stream

stream 流是在 HTTP/2 连接内在客户端和服务器之间交换的独立的双向帧序列。stream 流有几个重要的特征:

- 单个 HTTP/2 连接可以包含多个并发打开的 stream 流，任一一个端点都可能交叉收到来自多个 stream 流的帧。
- stream 流可以单方面建立和使用，也可以由客户端或服务器共享。
- 任何一个端都可以关闭 stream 流。
- 在 stream 流上发送帧的顺序非常重要。收件人按照收到的顺序处理帧。特别是，HEADERS 和 DATA 帧的顺序在语义上是重要的。
- stream 流由整数标识。stream 流标识符是由发起流的端点分配给 stream 流的。

### 其他

- 头部压缩: header 压缩是有状态的。一个压缩上下文和一个解压缩上下文用于整个连接。
- 服务器推送(server push)：服务器可以额外的向客户端推送资源，而无需客户端明确的请求(还没有收到浏览器的请求，服务器就把各种资源推送给浏览器)

## HTTP3

适当了解：

- HTTP3 基于 QUIC 传输协议：
  - 解决了 HTTP/2 什么问题：TCP 的冗余通信，TCP 的行头堵塞，TCP 不支持流级复用（不允许在一个 TCP 流中复用数据包）
  - QUIC 基于 UDP 传输协议，优点有：灵活的拥塞控制机制（TCP 印象中是将窗口缩小一半）。更好的错误处理能力。更快的握手。
